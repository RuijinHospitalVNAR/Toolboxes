# Google Apps Script 故障排除指南

## 问题：Script function not found: doGet

### 可能的原因和解决方案

#### 1. 文件名称问题 ⚠️ **最常见**

**问题**：代码可能不在正确的文件中，或者文件名称不正确。

**解决方案**：
- 确保代码在名为 `Code.gs` 的文件中
- 如果文件名称是其他名称（如 `ga-stats-complete.gs`），需要：
  1. 点击文件名称旁边的下拉菜单
  2. 选择"重命名"
  3. 重命名为 `Code.gs`
  4. 或者直接删除旧文件，创建新文件 `Code.gs` 并粘贴代码

#### 2. 代码未保存

**解决方案**：
- 按 `Ctrl+S`（Windows）或 `Cmd+S`（Mac）保存
- 或者点击"保存"按钮
- 确保看到"已保存"提示

#### 3. 部署版本问题

**解决方案**：
1. 点击"部署" > "管理部署"
2. 找到现有部署，点击右侧的"编辑"（铅笔图标）
3. **重要**：在"版本"下拉菜单中选择"新版本"（不要选择"Head"）
4. 点击"部署"
5. 等待部署完成

#### 4. 代码中有语法错误

**解决方案**：
1. 检查代码是否有红色下划线（语法错误）
2. 点击"运行"按钮测试代码
3. 查看是否有错误提示
4. 修复所有错误后再部署

#### 5. 函数名称拼写错误

**解决方案**：
- 确保函数名称是 `doGet`（大小写敏感）
- 不能是 `DoGet`、`dOGET` 或其他变体
- 函数必须接受一个参数 `e`

### 完整检查清单

- [ ] 代码在 `Code.gs` 文件中
- [ ] 代码已保存（看到"已保存"提示）
- [ ] 函数名称是 `doGet`（不是其他名称）
- [ ] 代码中没有语法错误（没有红色下划线）
- [ ] 部署时选择了"新版本"（不是"Head"）
- [ ] 部署设置：
  - [ ] 执行身份：我
  - [ ] 具有访问权限的用户：任何人
- [ ] 部署后等待几秒钟再测试

### 测试步骤

1. **测试代码是否可运行**：
   - 在 Apps Script 编辑器中，点击"运行"按钮
   - 选择 `doGet` 函数
   - 点击"运行"
   - 查看是否有错误

2. **测试 Web App URL**：
   ```
   https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?tool=all
   ```
   - 应该返回 JSON 数据
   - 不应该显示"Script function not found"错误

3. **测试单个工具**：
   ```
   https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?tool=vlpim
   ```

### 如果仍然无法解决

1. **创建新的部署**：
   - 删除旧部署
   - 创建全新的部署
   - 确保选择"新版本"

2. **使用简化版本测试**：
   - 使用 `ga-stats-simple.gs` 中的代码
   - 这个版本只返回 0，但可以验证 `doGet` 函数是否工作

3. **检查执行日志**：
   - 点击"执行" > "查看执行记录"
   - 查看详细的错误信息

### 快速修复步骤

1. 复制 `ga-stats-simple.gs` 中的代码
2. 在 Apps Script 中创建新文件 `Code.gs`
3. 粘贴代码
4. 保存（Ctrl+S）
5. 点击"部署" > "新建部署"
6. 选择"Web 应用"
7. 设置：
   - 执行身份：我
   - 具有访问权限的用户：任何人
   - 版本：新版本
8. 点击"部署"
9. 复制新的 Web App URL
10. 测试 URL

